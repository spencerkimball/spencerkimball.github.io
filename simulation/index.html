<!DOCTYPE html>
<meta charset="utf-8">

<head>
  <link rel="stylesheet" type="text/css" href="style.css" media="screen" />
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css' />
</head>

<body>
  <script src="d3.v3.js"></script>
  <script src="d3-path.v1.min.js"></script>
  <script src="d3-shape.v1.min.js"></script>
  <script src="model.js"></script>
  <script src="link.js"></script>
  <script src="locality.js"></script>
  <script src="locality_link.js"></script>
  <script src="node.js"></script>
  <script src="table.js"></script>
  <script src="range.js"></script>
  <script src="replica.js"></script>
  <script src="request.js"></script>
  <script src="app.js"></script>
  <script src="visualization.js"></script>
  <script src="localities.js"></script>
  <script src="boxes.js"></script>
  <script src="circles.js"></script>
  <div id="model"></div>
  <script>

function initModel(model) {
  model.nodeRadius = 40;
  model.projection = d3.geo.mercator();
  model.skin = new Localities();
  model.enablePlayAndReload = false;
  model.enableAddNodeAndApp = false;
  model.displaySimState = false;

  // US cities.
  var USCities = {
    new_york_city: {
      name: "New York City",
      location: [-74.0059, 40.7128],
    },
    des_moines: {
      name: "Des Moines",
      location: [-93.6091, 41.6005],
    },
    dallas: {
      name: "Dallas",
      location: [-96.7970, 32.7767],
    },
    mountain_view: {
      name: "Mountain View",
      location: [-122.0839, 37.3861],
    },
    seattle: {
      name: "Seattle",
      location: [-122.3321, 47.6062],
    },
  };

  // EU cities.
  var EUCities = {
    london: {
      name: "London",
      location: [-0.116721844, 51.49999473],
    },
    frankfurt: {
      name: "Frankfurt",
      location: [8.67501542, 50.09997683],
    },
    stockholm: {
      name: "Stockholm",
      location: [18.09733473, 59.35075995],
    },
  };

  // AU cities.
  var AUCities = {
    sydney: {
      name: "Sydney",
      location: [151.1851798, -33.92001097],
    },
    melbourne: {
      name: "Melbourne",
      location: [144.9750162, -37.82003131],
    },
    brisbane: {
      name: "Brisbane",
      location: [153.0350927, -27.45503091],
    },
  };

  // CN cities.
  var CNCities = {
    beijing: {
      name: "Beijing",
      location: [116.3882857, 39.92889223],
    },
    shanghai: {
      name: "Shanghai",
      location: [121.4365047, 31.21645245],
    },
    shenzhen: {
      name: "Shenzhen",
      location: [114.1221231, 22.55237051],
    },
  };

  // IN cities.
  var INCities = {
    mumbai: {
      name: "Mumbai",
      location: [72.8569893, 19.01699038],
    },
    bangalore: {
      name: "Bangalore",
      location: [77.56000972, 12.96999514],
    },
    new_delhi: {
      name: "New Delhi",
      location: [77.19998002, 28.60002301],
    },
  };

  var Regions = {
    "us": {
      name: "United States",
      cities: USCities,
    },
    "eu": {
      name: "European Union",
      cities: EUCities,
    },
    "au": {
      name: "Australia",
      cities: AUCities,
    },
    "cn": {
      name: "China",
      cities: CNCities,
    },
    "in": {
      name: "India",
      cities: INCities,
    },
  };

  // Add nodes in multiple rack in each city.
  var numRacks = 3,
      numNodes = 5;
  for (regionName in Regions) {
    var region = Regions[regionName]
    for (cityName in region.cities) {
      var city = region.cities[cityName];
      for (var k = 0; k < numRacks; k++) {
        for (var l = 0; l < numNodes; l++) {
          // Create localities for rack, datacenter (city here), and region.
          var locality = ["region=" + region.name, "city=" + city.name, "rack=rack " + k];
          new RoachNode("10.10." + (k + 1) + "." + (l + 1), city.location, locality, model);
        }
      }
    }
  }

  // Create tables, with a mix of spanning and local zone configs.

  // First, globally replicated tables.
  var globalZoneConfig = [["region=United States"], ["region=European Union"], ["region=Australia"], ["region=China"], ["region=India"]];
  var globalT1 = new Table("global.control", globalZoneConfig, model.splitSize * 2, model);
  var globalT2 = new Table("global.sso", globalZoneConfig, model.splitSize, model);
  for (i = 0; i < 5; i++) {
    new App(["*"] /* matches all nodes */, [globalT1, globalT2], model);
  }

  // App1 lives across united states and has three tables.
  var usSpanningConfig = [["city=New York City"], ["city=Des Moines"], ["city=Dallas"], ["city=Mountain View"], ["city=Seattle"]];
  var app1T1 = new Table("us.app1.customer", usSpanningConfig, model.splitSize * 1, model);
  var app1T2 = new Table("us.app1.item", usSpanningConfig, model.splitSize * 2, model);
  var app1T3 = new Table("us.app1.order", usSpanningConfig, model.splitSize * 5, model);
  for (i = 0; i < 5; i++) {
    new App(["region=United States"], [app1T1, app1T2, app1T3], model);
  }

  // App2 lives across eu and au and has three tables.
  var euauSpanningConfig = [["city=London"], ["city=Stockholm"], ["city=Frankfurt"], ["city=Sydney"], ["city=Melbourne"]];
  var app2T1 = new Table("euau.app2.user", euauSpanningConfig, model.splitSize * 1, model);
  var app2T2 = new Table("euau.app2.photo", euauSpanningConfig, model.splitSize * 2, model);
  var app2T3 = new Table("euau.app2.comment", euauSpanningConfig, model.splitSize * 5, model);
  new App(["city=London"], [app2T1, app2T2, app2T3], model);
  new App(["city=Stockholm"], [app2T1, app2T2, app2T3], model);
  new App(["city=Frankfurt"], [app2T1, app2T2, app2T3], model);
  new App(["city=Sydney"], [app2T1, app2T2, app2T3], model);
  new App(["city=Melbourne"], [app2T1, app2T2, app2T3], model);

  // App3 lives only in China.
  var cnSpanningConfig = [["city=Shenzhen"], ["city=Shanghai"], ["city=Beijing"]];
  var app3T1 = new Table("cn.app3.merchant", cnSpanningConfig, model.splitSize * 2, model);
  var app3T2 = new Table("cn.app3.catalog", cnSpanningConfig, model.splitSize * 10, model);
  var app3T3 = new Table("cn.app3.product", cnSpanningConfig, model.splitSize * 15, model);
  for (i = 0; i < 5; i++) {
    new App(["region=China"], [app3T1, app3T2, app3T3], model);
  }

  // App4 spans China, India & Australia.
  var asiaSpanningConfig = [["city=Shenzhen"], ["city=Shanghai"], ["city=Bangalore"], ["city=Sydney"], ["city=Brisbane"]];
  var app4T1 = new Table("asia.app4.bank", asiaSpanningConfig, model.splitSize, model);
  var app4T2 = new Table("asia.app4.account", asiaSpanningConfig, model.splitSize * 2, model);
  var app4T3 = new Table("asia.app4.transaction", asiaSpanningConfig, model.splitSize * 5, model);
  new App(["city=Shenzhen"], [app4T1, app4T2, app4T3], model);
  new App(["city=Shanghai"], [app4T1, app4T2, app4T3], model);
  new App(["city=Bangalore"], [app4T1, app4T2, app4T3], model);
  new App(["city=Sydney"], [app4T1, app4T2, app4T3], model);
  new App(["city=Brisbane"], [app4T1, app4T2, app4T3], model);

  // App5 lives only in Mountain View.
  var mtvConfig = [["city=Mountain View", "rack=rack 0"], ["city=Mountain View", "rack=rack 1"], ["city=Mountain View", "rack=rack 2"]];
  var app5T1 = new Table("mtv.app5.account", mtvConfig, model.splitSize * 2, model);
  var app5T2 = new Table("mtv.app5.ledger", mtvConfig, model.splitSize * 4, model);
  var app5T3 = new Table("mtv.app5.transaction_leg", mtvConfig, model.splitSize * 10, model);
  for (i = 0; i < 3; i++) {
    new App(["region=United States"], [app5T1, app5T2, app5T3], model);
  }

  addModel(model);
}
new Model("model", viewWidth, viewHeight * 1, function(m) { initModel(m); });

</script>
</body>
